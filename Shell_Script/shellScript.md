# shell脚本基础篇

## Shell简介

### Shell是什么？

​	shell是用户与Linux内核沟通的桥梁，用户的大部分工作是通过Shell完成的。Shell脚本不是linux内核的一部分，他调用了系统核心的大部分功能来执行脚本。

​	Shell是一块包裹着系统核心的壳，处于操作系统的最外层，与用户直接对话，将用户的输入，通过解释器解释给操作系统，随后操作系统操作计算机硬件，然后处理操作系统的输出结果，输出到屏幕给用户看到结果。

​	通俗理解，我们在linux系统中打开一个终端，输入`ls`命令会在终端中看到当前目录下的所有文件。这个过程中，打开终端，终端会调用`/usr/bin/bash`壳程序，用来解释分析用户输入的内容并加以相应。此时，我们输入了`ls`命令，Shell程序解析出`ls`是一个命令，随后在PATH环境变量中寻找ls可执行文件的位置，找到后会调用该程序并传递参数，随后将执行结果输出到屏幕中。

### Shebang

​	Shebang（亦称为释伴）是一个由井号(#)和叹号(!)组成的字符序列，通常位于脚本文件的第一行。Shebang**指明了执行该脚本文件的解释器路径**，使得脚本可以像普通的可执行文件一样被调用。

```shell
#! /usr/bin/bash
```

注意点：

1. 如果脚本文件中没有 `#!` 这一行，那么它执行时会默认用当前 Shell 去解释这个脚本(即：`$SHELL` 环境变量）。
2. 如果你使用 `bash test.sh` 这样的命令来执行脚本，那么`#!`这一行将会被忽略掉，解释器当然是用命令行中显式指定的 bash。



## 变量

​	Shell变量是用来存储数据值的名称

### 定义变量

​	变量定义时，变量名，等号，数据值三者之间不能由空格。数据值加不加双引号都可以。

​	定义时需要遵循固定原则：

- **只包含字母、数字和下划线：** 变量名可以包含字母（大小写敏感）、数字和下划线 _，不能包含其他特殊字符。
- **不能以数字开头：** 变量名不能以数字开头，但可以包含数字。
- **避免使用 Shell 关键字：** 不要使用Shell的关键字（例如 if、then、else、fi、for、while 等）作为变量名，以免引起混淆。
- **使用大写字母表示常量：** 习惯上，常量的变量名通常使用大写字母，例如 PI=3.14。
- **避免使用特殊符号：** 尽量避免在变量名中使用特殊符号，因为它们可能与 Shell 的语法产生冲突。
- **避免使用空格：** 变量名中不应该包含空格，因为空格通常用于分隔命令和参数。

```shell
name="wangshuqiang"
var="123"
var2=456
```

​	Shell中数据类型是一种弱类型，没有C语言中的整形，字符型，浮点型这种强类型。通常都是一字符串的形式进行处理。

### 使用变量

​	使用定义过的变量时，有两种方式，第一种作为简写，第二种是全写。加花括号是为了帮助解释器识别变量的边界。推荐给所有变量加上花括号，这是个好的编程习惯。

```shell
#第一种
echo $name
#第二种
echo ${name}
```



### 只读变量

​	使用`readonly`命令可以将变量定义为只读变量。只读变量的数值不可以随意更改。

```shell
#!/bin/bash

myUrl="https://www.google.com"
readonly myUrl
myUrl="https://www.runoob.com"
```



### 删除变量

​	使用`unset`删除变量，变量被删除后无法被继续使用。无法删除只读变量



### 字符串变量

​	字符串是shell编程中最常用最有用的数据类型，字符串可以用单引号，也可以用双引号，也可以不用引号。

​	单引号里面不能识别特殊语法，单引号里的任何字符都会原样输出，同时，单引号中不能出现单引号（使用转义符也不行），但可以成对出现，作为字符串拼接使用。

​	双引号中可以连同变量一起使用，也可以出现转义字符。双引号也可以作为拼接字符串使用。



### 获取字符串长度

​	可以通过`#`获取字符串长度

```shell
//获取字符串长度
name="wangshuqiang"
echo ${#name} #结果输出为 12
```



### 提取字符串

```shell
name="wangshuqiang"
#从第1个位置的字符开始计算，获取4个字符长度的字符串。   字符位置从0开始
echo ${name:1:4}
```



### 数组变量

​	bash支持一维数组（不支持多维数组），并且没有限定数组的大小。

​	数组下表从0开始。

​	在 Shell 中，用括号来表示数组，数组元素用"空格"符号分割开，使用时同样采用`$`符号 + 数组名[下表]

```shell
# 数组名=(数值1 数值2 数值3)
namebuf=(zhao qian sun li zhou wu zheng wang)

# 使用单个数组值
echo ${namebuf[0]} # 打印数组中第0个数组成员变量的数值
echo ${namebuf[2]} # 打印数组中第2个数组成员变量的数值
echo ${namebuf[3]} # 打印数组中第3个数组成员变量的数值

# 打印全部数组值 @ 和 *都可以获取数组中全部的元素
echo ${namebuf[@]}
echo ${namebuf[*]}
```

​	

获取数组长度与获取字符串长度相同，同样采用符号`#`来获取

```shell
# 获取数组个数
echo ${#namebuf[@]}
echo ${#namebuf[*]}

# 获取第n个数组成员的长度
echo ${#namebuf[n]}
```



### 关联数组

​	shell脚本中支持关联数组又称字典，与数组类似，不同的是，字典可以用字符串作为索引值，可以存储无序的键值对，而数组需要以索引为键值顺序存储数据。

​	特别的，字典建立时需要实现声明，使用`declare -A`声明关联数组。

​	使用`!`符号可以获取到字典中全部的key值，特别的，`!`符号无法获取单个key值，例如~~echo ${!dictionary["li"]}~~是没有意义的，既然知道“li”获取还有什么意义呢？

```shell
declare -A dictionary

dictionary=(["li"]="liguangzhu" ["liu"]="liuzaishi" ["quan"]="quanshaomin" ["song"]="songzhixiao" ["ha"]="haha" ["chi"]="chixizhen")

echo "获取关联数组内全部数据值" ${dictionary[*]}

echo '获取key值为"quan"的值=' ${dictionary["quan"]}

echo "获取字典中全部的key值" ${!dictionary[*]}

echo "获取字典中数据个数="${#dictionary[*]}
```



```shell
//输出结果

开始运行shell脚本
获取关联数组内全部数据值 liguangzhu songzhixiao haha chixizhen quanshaomin liuzaishi
获取key值为"quan"的值= quanshaomin
获取字典中全部的key值 li song ha chi quan liu
获取字典中数据个数=6
```





### 注释

​	shell脚本开发中，在每行的开头输入`#`符号表明改行内容需要被注释，以此达到注释单行的效果。

​	如果想要多行注释，可以采用  `: + 空格 + 单引号`

```shell
: `
echo ${namebuf[*]}
echo ${namebuf[*]}
echo ${namebuf[*]}
echo ${namebuf[*]}
echo ${namebuf[*]}
echo ${namebuf[*]}
echo ${namebuf[*]}
`
```



## 参数传递

​	shell脚本运行时可以向脚本内程序传递参数，类似于函数参数一样，典型的例子就是发掘linux-kit脚本执行时后边需要加参数。

```shell
// 生成layout文件
./misc/bin/vdtools layout
// 生成图片bin文件
./msic/bin/vdtools image
```

​	程序中可以通过`$`符号来获取执行脚本时添加的参数。获取参数的格式为 `$n`，**n** 代表一个数字，**1** 为执行脚本的第一个参数，**2** 为执行脚本的第二个参数。**0**也可以获取到参数，通常获取到的时执行的命令。以下为示例

```shell
#!/usr/bin/bash
echo "开始运行shell脚本"

echo '第零个参数'"$0"
echo '第一个参数'"$1"
echo '第二个参数'"$2"

echo '获取到传递参数个数为' "$#"

echo '$*显示传递进来的全部参数' "$*"
echo '$@显示传递进来的全部参数' "$@"
```



```shell
// 执行命令
./shell.sh 1 2 4 5 4 2

// 结果输出
开始运行shell脚本
第零个参数./shell.sh
第一个参数1
第二个参数2
获取到传递参数个数为 6
$*显示传递进来的全部参数 1 2 4 5 4 2
$@显示传递进来的全部参数 1 2 4 5 4 2
```



## 运算符

​	运算符计算中，通常使用命令**$()**或者是**``**,该命令作用是将结果替换到所的位置，使得你可以将该结果赋值给变量或用于其他命令。与之形式上相近的是`${}`,这个命令主要用于引用变量的值。二者要注意区分。

### 基本运算符

​	包含五种常用运算符。加/减/乘/除/取余。可使用`val=$(expr X @ Y)`获取结果，上式中`@`符号指代五种运算符号，即 + - *  /  %。特别的，由于linux中`*`符号作为通配符使用。因此当用作乘号时需要在前边添加转义符`\`

```shell
val=$(expr 2 + 6)
echo ${val}

val=$(expr 4 - 6)
echo ${val}

val=$(expr 2 \* 6)
echo ${val}

val=$(expr 15 / 6)
echo ${val}

val=$(expr 2 % 6)
echo ${val}
```

```
//输出结果
8
-2
12
2
2
```

### 关系运算符

​	关系运算符主要用来判断相等/不相等/大于/小于/大于等与/小于等于。特别的，关系运算符只能用于数字判定，不支持字符串判断，除非字符串的值时数字。例如：

​	`if [ "21" -eq "21" ]`   判定为真

​	~~if [ "name" -eq "name" ]~~   是错误的

| 运算符  | 说明                            | 举例                      |
| ---- | ----------------------------- | ----------------------- |
| -eq  | 检测两个数是否相等，相等返回 true。          | [ $a -eq $b ] 返回 false。 |
| -ne  | 检测两个数是否不相等，不相等返回 true。        | [ $a -ne $b ] 返回 true。  |
| -gt  | 检测左边的数是否大于右边的，如果是，则返回 true。   | [ $a -gt $b ] 返回 false。 |
| -lt  | 检测左边的数是否小于右边的，如果是，则返回 true。   | [ $a -lt $b ] 返回 true。  |
| -ge  | 检测左边的数是否大于等于右边的，如果是，则返回 true。 | [ $a -ge $b ] 返回 false。 |
| -le  | 检测左边的数是否小于等于右边的，如果是，则返回 true。 | [ $a -le $b ] 返回 true。  |

```shell
// 示例
if [ 12 -eq 12 ]
then
   echo  等于 
else
   echo  不等于
fi
```

### 布尔运算符

| 运算符  | 说明                                 | 举例                                    |
| ---- | ---------------------------------- | ------------------------------------- |
| !    | 非运算，表达式为 true 则返回 false，否则返回 true。 | [ ! false ] 返回 true。                  |
| -o   | 或运算，有一个表达式为 true 则返回 true。         | [ $a -lt 20 -o $b -gt 100 ] 返回 true。  |
| -a   | 与运算，两个表达式都为 true 才返回 true。         | [ $a -lt 20 -a $b -gt 100 ] 返回 false。 |

### 逻辑运算符

| 运算符  | 说明      | 举例   |
| ---- | ------- | ---- |
| &&   | 逻辑的 AND |      |
| \|\| | 逻辑的 OR  |      |

### 字符串运算符

| 运算符  | 说明                          | 举例                    |
| ---- | --------------------------- | --------------------- |
| =    | 检测两个字符串是否相等，相等返回 true。      | [ $a = $b ] 返回 false。 |
| !=   | 检测两个字符串是否不相等，不相等返回 true。    | [ $a != $b ] 返回 true。 |
| -z   | 检测字符串长度是否为0，为0返回 true。      | [ -z $a ] 返回 false。   |
| -n   | 检测字符串长度是否不为 0，不为 0 返回 true。 | [ -n "$a" ] 返回 true。  |
| $    | 检测字符串是否不为空，不为空返回 true。      | [ $a ] 返回 true。       |

### 自增/自减操作符

	#### 方式1 使用let命令

​	`let`命令允许对整数进行算数计算

```shell

num=5

let num++

echo $let

```

#### 方式二 使用expr命令

```

num=8
num=$(expr ${num} + 2)
echo ${num}
```

#### 方式三 使用$(())

​	`$(())`用于求值并返回结果。可以将其结果赋值给变量。计算num + 4的结果并将结果返回赋值给num自身

```shell

num=9
num=$((num + 4))
echo ${num}
```

#### 方式四 使用(())

​	用于执行算术运算，但不返回结果。通常用于条件判断。这里只是进行计算，并不会将结果返回。

```
num=6
((num + 13))

//得到的结果仍然是6
echo ${num}

((num++))
// 这里得到的结果为7，因为++是自增操作，会在自身的基础上增加1
echo ${num}
```



## 流程控制

​	在shell中，流程控制不可以为空，即以下程序在C语言中合理，但是在shell中不合理。shell中如果else分支没有语句执行，就要将else删除。

```C
#include <stdio.h>
int main(void)
{
  int a = 0;
  if(!a)
  {
    printf("a的值为0");
  }
  else
  {
    ；
  }
  return 0;
}
```

### if... else语句

```shell
//多行书写
if condition
then
	command1
	command2
	command3
else
	command4
fi

// 当行书写
if condition; then echo "test" else echo "haha" fi
```

### if...else-if...else

```shell
// 格式
if condition
then 
	command1
	command2
elif
then
	command3
	command4
else
	command5
fi
```

### for循环

​	当变量值在列表里，for 循环即执行一次所有命令，使用变量名获取列表中的当前取值。命令可为任何有效的 shell 命令和语句。in 列表可以包含替换、字符串和文件名。

```shell
// 格式
for var in item1 item2 item3
do
	command1
	command2
	command3
done
```



### while语句

```shell
// 格式
while condition
do
	command1
	command2
	command3
done


// shell中三种死循环
//第一种
while :
do
	command
done

//第二种
while true
do
	command
done

//第三种
for(( ; ; ))
```



### until循环

​	作用与while相同，都是进行循环，但判断条件相反，while是当条件为真时执行循环体，然而until是当条件为假时才会执行循环体。

```shell
//格式

until condition
do
	command
done	
```



### case ... esac

​	case语句为多选择语句，与C语言中switch case语句相似，是一种多分枝选择结构。

格式说明：

​	shell中每个case语句采用右括号开始，用`;;`符号表示break，执行结束，跳出case.shell中使用`*`符号表示默认值

```shell
//格式
case var in 
条件1)
	command1
	command2
	command3
	;;
条件2)
	command4
	command5
	;;
条件3）
	command6
	;;
esac
```



## 函数

​	shell中允许使用函数，格式如下：

```shell
[ function ] funname [()]
{
    action;
    [return int;]
}
```

​	以上函数使用过程中，参数返回，可以显式加**return** 返回，如果不加，将以最后一条命令运行结果，作为返回值。 **return** 后跟数值 n(0-255)。

​	想要获取函数返回值，可以通过`$?`符号来获得。所有函数使用之前必须先定义后使用。

​	特别的，return返回值只能介于0~255之间的整数，而计算两数字的和很容易超出该范围。由此，可以不适用return返回，函数最后直接写`echo ${var}`, 函数调用之后使用 `$?`符号进行使用。

### 函数参数

​	shell调用函数时，可以像函数内传递参数，与执行shell带参数相同，函数中可以通过`$n`来获取参数数值。特别的，当参数位序大于等于10的时候，使用时需要使用大括号保护即 `${10}`,如果使用`$10`,shell会将其认定为`$1` 与`0`的结合，造成程序出现错误。



## 输出重定向

​	通常，大多数linux命令从终端中输入，执行后将结果输出到终端中，输出重定向可以将命令输出到特定位置。例如文件中。

​	可以通过`>`符号 + 文件名的形式，将输出重定向至文件中。如：`ls -al > test`

​	此时，可以使用`cat test`观察到输出test文件中的内容。

​	特别的，`>`符号会 覆盖之前缓存的文件内容，如果向保留之前的内容在其后边添加内容，只需要使用`>>`符号将内容添加至文件末尾。



## 文件包含

​	与C语言中include功能类似，shell中也可以包含外部脚本，便于封装公共代码。

```shell
// 格式
. filepath
或者
source filepath
```

​	引用后，文件会在被调用处展开，供其他命令调用。