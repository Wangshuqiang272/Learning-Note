# 										鸟哥的LINUX私房

## 第二部分 Linux文件、目录与磁盘格式

- **用户与用户组**

  1. 文件拥有者

     ​	该文件的所有者

  2. 用户组

     ​	多个用户组成的集合

  3. 其他人

     ​	出去上述两种身份的人

- root身份

  ​	**万能的天神，能够到达任何他想去的地方**

## 2.1 linux文件权限概念

### 2.1.1Linux文件属性

​		1.命令介绍

```bash
ls -al                #显示当前路径下全部文件的文件名与相关属性
```

​		2.样例分析

```bash
drwxr-xr-x  2 thawne thawne  4096 1月  10 09:01 file_test
```

​		d/f	------------	表明这是一个文件/目录 d -> 文件  f -> 目录

​		rwx  ------------	表明该文件的属性的拥有者/所属群组/其他人的三种权限，分别为可读，可写，可执行，其中，有字母代表有该项权限，固定位置处位-则代表没有该权限。

​		数字 2 代表有两个文件名链接到此节点

​		第三栏表示该文件的拥有者账号

​		第四栏表示该文件的所属用户组

​		第五栏表示该文件的容量大小，注意，**因为linux的文件系统的原因，这里显示的只是目录的大小，不是该目录下包含多少大小的文件**

​		第六栏、第七栏分别代表该文件的最近修改日期以及文件名称

### 2.1.2修改文件属性与权限

1. **chgrp  修改文件所属群组**

   命令格式

   ```shell
   chgrp -r groupname filename/dirname  # -r 代表递归的意思，如果更改文件的用户组不需要，更改目录的时候加 -r 会连同当前目录下所有文件都更改
   ```

   **注意：如果想将文件由用户组A改为用户组B，则A，B必须在/etc/group文件中存在。**

2. **chown 修改文件拥有者**

   命令格式

   ```shell
   1. chown -r accountname filename/dirname
   2. chown -r accountname:groupname filename/dirname
   ```

   **注意：1.同上，想要修改为用户A，则用户A必须存在与/etc/passwd**

   ​           **2. -r 用法与上述相同**

3. **chmod修改文件权限**

   命令格式

   ```shell
   基础用法：chmod -r xxx filename/dirname #xxx为对应用户，用户组，其他人的代表数字 -r 递归
   进阶用法：chmod u=rwx，g=rx，o=rx filename
   		chmod u/g/o/a +/- r/w/x filename 
   ```


## 3.常用命令说明

### 3.1 cat命令

   **作用：连接文件并打印到标准输出设备上，主要用于查看和连接文件**

   ```SHELL
   cat [选项] [文件]
   常用参数：
   -n：显示行号，会在输出的每一行前加上行号。
   -b：显示行号，但只对非空行进行编号。
   -s：压缩连续的空行，只显示一个空行。
   ```

      1. 常用来显示文件内容  `cat filename`
      2. 连接文件：`cat file1 file2 > combined_file` 可以将 file1 和 file2 的内容连接起来，并将结果输出到 combined_file 中。cat file1 file2 将连续显示两个文件的内容，此时，借助重定向符号'>'即可将连续输出的文件内容写入到新文件中。由此达到内容拼接效果
      3. 创建/清除文件内容 `cat /dev/null > newfilename`. dev/null是一个空设备文件，使用cat显示该文件将不会有任何输出。由此，将空的输出内容重定向至文件既可以一次创建新文件，同时可以一次性清除文件内容。
      4. `cat -n filename`显示文件 filename 的内容，并在每行的前面加上行号。


### 3.2 cksum命令

   **用于检查文件的CRC是否正确。确保文件从一个系统传输到另一个系统的过程中不被损坏**

   ```shell
    cksum [--help][--version][文件...]

   用法：cksum testfile1 
   ```

   ```shell
   cksum filename

   1263453430 78 filename
   ```
   其中，"1263453430" 表示校验码， "78"表示字节数


### 3.3 file命令

   ```shell
   file [-bcLvz][-f <名称文件>]
   ```
   * -b 列出辨识结果时，不显示文件名称
   * -z 尝试去解读压缩文件的内容。

   ```shell
   file test.txt
   file -b test.txt
   ```

### 3.4 find命令

   **find 命令用于在指定目录下查找文件和目录**

   ```shell
   find [路径] [匹配条件] [动作]
   ```


* **路径 **：选择需要查找的路径，可以是一个目录或者是文件夹，也可以是多个路径，用空格间隔。若未指出，则默认为当前目录。
* **匹配条件**：用于指定查找的条件，通常是文件名称、文件类型。条件总共有20~30个，但常用的主要是几个
  * -name ： 按文件名查找，支持通配符*与？
  * -type：按照文件类型查找，可以是f（文件）、d（目录）、l（符号链接）
  * -mtime：按修改时间查找，使用+ 或者 -表示查找指定天数前后。
    * 格式为(动作)(时间）
      * 动作：表示查找的是修改的(m)/更改的(c)/被访问的(a)
      * 时间：表示时间跨度，分钟(min)/小时(time)
* **动作**：表示对匹配到的文件进行操作。比如可以对找到的文件批量重命名。

```shell
# 示例一 在/etc/apt目录下找名字中包含"source"的全部文件
find /etc/apt -name "source*"   
# 结果
-----------------------------
/etc/apt/sources.list
/etc/apt/sources.list.d
-----------------------------

# 示例二，在/etc/apt目录下查找全部的文件夹
find /etc/apt -type d
# 结果显示
-----------------------------
/etc/apt
/etc/apt/auth.conf.d
/etc/apt/preferences.d
/etc/apt/trusted.gpg.d
/etc/apt/apt.conf.d
/etc/apt/sources.list.d
/etc/apt/keyrings
----------------------------

#示例三 查找/etc/apt目录下一周内更改过的文件
find /etc/apt/ -ctime -7
# 结果
----------------------------------------
/etc/apt/
/etc/apt/sources.list
----------------------------------------

#示例三 查找/etc/apt目录下40分钟内更改过的文件
find /etc/apt/ -cmin -40
# 结果
----------------------------------------
/etc/apt/
/etc/apt/sources.list
----------------------------------------
```





### 3.5 ln命令

​	ln命令又称为软连接命令，作用是为某一个文件在另外一个位置建立一个同步的链接。当我们需要在不同的目录，用到相同的文件时，我们不需要在每一个需要的目录下都放一个必须相同的文件，我们只要在某个固定的目录，放上该文件，然后在 其它的目录下用ln命令链接（link）它就可以，不必重复的占用磁盘空间。

```shell
 ln [参数][源文件或目录][目标文件或目录]
```

 

`常用参数`：

1. `-s`:软链接(符号链接)
2. `-d`:允许超级用户制作目录的硬链接
3. `-i`:交互模式，文件存在则提示用户是否覆盖

* 软链接

  ```shell
  # 将Templates/testdir目录设置一个软连接，软连接名称为lndir
  ln -s Templates/testdir lndir
  ```

  设置一个软连接之后，可以通过该软连接进行`ls`、`cat`、`vim`等命令操作。

  若使用chmod更改软连接的文件权限，实际上更改的是软连接指向的文件权限，而不是软连接本身的权限。

* 硬链接

  ```shell
  # 为Templates/test.txt文件夹设置一个硬链接，硬链接名称为testhardln
  ln Templates/test.txt testardln
  ```

  ​

  ​	软链接可以理解为windows系统中的快捷方式，这个比较好理解，下面着重说明一下硬链接。

  ​	我们都知道，文件的内容是与inode序号息息相关的，硬链接是通过文件系统的inode链接来产生新文件名，当我们创建了一个新的硬链接，就是新增了一条文件名链接到了相同的inode号码中。当我们删除了源文件时，源文件与inode的关联关系被删除，此时硬链接的关联关系还存在，因此，此时仍然可以访问该文件。

  ​	另外说明，linux系统中，文件内容与inode强相关，当我们删除一个文件时，实际上是删除了indoe与文件名的关联关系，短时间内，文件内容依旧哎磁盘中存储，当系统记录的链接计数(每新增一个硬链接数值都会加1)值为0时，表示该文件内容没有任何链接与之连接，此时会将这段空间标志为**空闲**，具体何时被复用或者清除呦操作系统决定。

  ​	同时，硬链接可以借助C语言中的指针进行理解。inode即为malloc申请的一块空间地址。文件即为空间内的数据内容。当创建一个硬链接时，就是创建一个指针变量指向了这个inode地址。当最开始的指针被销毁了，还有其他的指针指向目标空间，此时还是可以通过硬链接访问内容。当所有的指针都被释放时，此时inode也将被销毁。
